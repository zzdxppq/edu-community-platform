# Test Design: 1.2 - 后端微服务基础框架搭建

2026-02-06 | JW (QA Engineer)

## Overview

Total: 28 | Unit: 10 (36%) | Integration: 18 (64%) | E2E: 0 (0%)
Priority: P0: 10, P1: 16, P2: 2
Blind Spot Scenarios: 6

## Scenarios by AC

### AC-1: 四个微服务模块可独立启动且注册到 Nacos

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 1.2-INT-001 | I | P0 | gateway 独立启动并注册到 Nacos | 核心功能：服务注册 |
| 1.2-INT-002 | I | P0 | core-service 独立启动并注册到 Nacos | 核心功能：服务注册 |
| 1.2-INT-003 | I | P0 | content-service 独立启动并注册到 Nacos | 核心功能：服务注册 |
| 1.2-INT-004 | I | P0 | file-service 独立启动并注册到 Nacos | 核心功能：服务注册 |
| 1.2-INT-005 | I | P0 | Nacos 服务列表显示4个服务，实例数 ≥ 1 | 注册完整性验证 |
| 1.2-UNIT-001 | U | P1 | 验证各服务端口配置正确 (8080/8081/8082/8083) | 配置纯值验证 |
| 1.2-UNIT-002 | U | P1 | 验证各服务 bootstrap.yml 包含 Nacos 配置 | 配置结构验证 |
| 1.2-UNIT-003 | U | P1 | 验证四个服务名称在 bootstrap.yml 中唯一 | 配置唯一性约束 |
| 1.2-INT-006 | I | P1 | Nacos 不可用时服务 fail-fast 退出 | 错误处理需求 |

### AC-2: API Gateway 路由转发正常

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 1.2-INT-007 | I | P0 | Gateway 将 /api/core/** 路由到 core-service | 核心路由功能 |
| 1.2-INT-008 | I | P0 | Gateway 将 /api/content/** 路由到 content-service | 核心路由功能 |
| 1.2-INT-009 | I | P0 | Gateway 将 /api/file/** 路由到 file-service | 核心路由功能 |
| 1.2-UNIT-004 | U | P1 | Gateway application.yml 包含 lb:// 动态路由配置 | 配置验证：Nacos 服务发现 |
| 1.2-UNIT-005 | U | P1 | Gateway POM 不包含 spring-boot-starter-web | 约束验证：WebFlux |

### AC-3: 健康检查端点返回正常

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 1.2-INT-010 | I | P0 | 四个服务 /actuator/health 返回 200 {"status":"UP"} | 核心健康检查 |
| 1.2-INT-011 | I | P1 | Gateway 仅暴露 /actuator/health，不暴露其他敏感端点 | 安全约束验证 |
| 1.2-INT-012 | I | P1 | 业务服务暴露 /actuator/health 和 /actuator/info | 端点暴露策略验证 |

### AC-4: Maven 父工程管理统一依赖版本

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 1.2-UNIT-006 | U | P1 | 父 POM dependencyManagement 包含所有要求的依赖版本 | 版本管理完整性 |
| 1.2-UNIT-007 | U | P1 | 子模块 POM 未硬编码依赖版本号 | 版本管理约束 |
| 1.2-UNIT-008 | U | P1 | common 模块被三个业务服务正确引用 | 依赖关系验证 |

### AC-5: JDK 21 编译运行正常

| ID | Lvl | Pri | Test | Why |
|----|-----|-----|------|-----|
| 1.2-INT-013 | I | P0 | mvn clean compile 全量编译成功，零错误 | 核心编译验证 |
| 1.2-UNIT-009 | U | P1 | 父 POM java.version=21 配置正确 | 配置验证 |

## Blind Spot Scenarios [BLIND-SPOT]

| ID | Category | Pri | Scenario | Ref |
|----|----------|-----|----------|-----|
| 1.2-BLIND-BOUNDARY-001 | BOUNDARY | P2 | Gateway 处理路由前缀后空路径请求 (如 /api/core/) | BOUNDARY-001 |
| 1.2-BLIND-BOUNDARY-002 | BOUNDARY | P1 | Gateway 处理未知路由前缀请求 (如 /api/unknown/**) | BOUNDARY-004 |
| 1.2-BLIND-ERROR-001 | ERROR | P1 | 服务启动后 Nacos 连接断开的行为 | ERROR-002 |
| 1.2-BLIND-ERROR-002 | ERROR | P1 | Gateway 目标服务不可用时返回合适的错误响应 | ERROR-002 |
| 1.2-BLIND-ERROR-003 | ERROR | P2 | 服务使用无效 bootstrap.yml 配置启动的行为 | ERROR-003 |
| 1.2-BLIND-RESOURCE-001 | RESOURCE | P1 | 验证 Gateway 使用 WebFlux (非 Servlet 容器) | RESOURCE-001 |

## Risk Coverage

| Risk | Mitigated By |
|------|-------------|
| 服务无法注册到 Nacos | INT-001~005, INT-006, BLIND-ERROR-001 |
| 路由转发失败 | INT-007~009, BLIND-BOUNDARY-001~002, BLIND-ERROR-002 |
| 健康检查端点不可用 | INT-010~012 |
| 版本冲突导致编译失败 | UNIT-006~008, INT-013 |
| JDK 兼容性问题 | UNIT-009, INT-013 |
| Gateway 误用 Servlet 模式 | UNIT-005, BLIND-RESOURCE-001 |

## Execution Order

1. P0 Unit: UNIT-001~003 (配置验证，快速反馈)
2. P0 Integration: INT-013 (编译验证)
3. P0 Integration: INT-001~005 (服务启动与注册)
4. P0 Integration: INT-007~010 (路由与健康检查)
5. P1 Unit: UNIT-004~009 (配置约束验证)
6. P1 Integration: INT-006, INT-011~012 (错误处理与端点安全)
7. P1 Blind Spot: BLIND-BOUNDARY-002, BLIND-ERROR-001~002, BLIND-RESOURCE-001
8. P2 Blind Spot: BLIND-BOUNDARY-001, BLIND-ERROR-003

## Gate YAML

```yaml
test_design:
  scenarios_total: 28
  by_level: {unit: 10, integration: 18, e2e: 0}
  by_priority: {p0: 10, p1: 16, p2: 2}
  blind_spot_scenarios:
    total: 6
    by_category: {BOUNDARY: 2, ERROR: 3, FLOW: 0, CONCURRENCY: 0, DATA: 0, RESOURCE: 1}
  coverage_gaps: []
```
